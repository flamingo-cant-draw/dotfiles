#! /usr/bin/env raku

# Reddit saves images as webp unless you view image
# this just convert webp files en mass to thier normal format

sub remove-all-the-webp(IO::Path:D @dir) {
	for @dir -> $file {
		if $file.d {
			remove-all-the-webp Array[IO::Path].new($file.dir);
		} elsif $file ~~ /\..*\.webp/ {
			shell "dwebp $file -o " ~ $file.subst(/\.webp/);
			unlink $file;
		}
	}
}

# make sure `dwebp` is installed
my $command = run 'which', 'dwebp', :out, :err;
die "Command dwebp is not installed" if $command.err.slurp;

remove-all-the-webp Array[IO::Path].new("$*HOME/Pictures".IO.dir);
